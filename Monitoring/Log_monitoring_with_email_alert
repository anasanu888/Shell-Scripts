#!/bin/bash

# ðŸ”¹ Log file to monitor
LOG_FILE="/var/log/messages"

# ðŸ”¹ Keyword to search
KEYWORD="ERROR"

# ðŸ”¹ Email details (change as needed)
TO="admin@example.com"
SUBJECT="âš ï¸ Log Alert: Error detected on $(hostname)"
TMP_FILE="/tmp/error_alert.txt"

# ðŸ”¹ Check if log file exists
if [ ! -f "$LOG_FILE" ]; then
    echo "âŒ Log file not found: $LOG_FILE"
    exit 1
fi

# ðŸ”¹ Search for keyword (case-insensitive & quiet)
if grep -iq "$KEYWORD" "$LOG_FILE"; then
    echo "âš ï¸ Error detected in $LOG_FILE"

    # Save last 10 error lines to temporary file
    {
        echo "Server: $(hostname)"
        echo "Date: $(date)"
        echo "Log file: $LOG_FILE"
        echo ""
        echo "Last 10 error lines:"
        grep -i "$KEYWORD" "$LOG_FILE" | tail -10
    } > "$TMP_FILE"

    # Send email alert (requires 'mail' or 'mailx' package)
    mail -s "$SUBJECT" "$TO" < "$TMP_FILE"

    echo "ðŸ“§ Email alert sent to $TO"
else
    echo "âœ… No errors found in logs"
fi
